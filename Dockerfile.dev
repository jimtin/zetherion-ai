# Development Dockerfile using Chainguard
# Includes dev tools, hot reload support, and full shell access
#
# Security: Chainguard images have zero known CVEs vs 19+ in Debian-based images

FROM cgr.dev/chainguard/python:latest-dev

WORKDIR /app

# Copy dependency files
COPY requirements.txt requirements-dev.txt ./

# Install all dependencies including dev and create data directory
# PYO3_USE_ABI3_FORWARD_COMPATIBILITY allows pydantic-core to build on Python 3.14
ENV PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1
RUN pip install --no-cache-dir -r requirements-dev.txt && \
    mkdir -p /app/data

# Set Python path
ENV PYTHONPATH=/app/src

# Source will be mounted as volume for hot reload
# Note: ENTRYPOINT is /usr/bin/python, so we only need the module args
CMD ["-m", "watchfiles", "python -m zetherion_ai", "./src"]
